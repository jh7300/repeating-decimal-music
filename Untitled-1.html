<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Tone.js Sampler (C/F# 8ìƒ˜í”Œ)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/tone@14.8.49/build/Tone.js"></script>
  <style>
    body{margin:0;background:#0f172a;color:#e2e8f0;font-family:ui-sans-serif,system-ui}
    .wrap{max-width:760px;margin:0 auto;padding:20px}
    button, input[type=range]{margin:.25rem .4rem;padding:.6rem 1rem;border:0;border-radius:.6rem;background:#1f2937;color:#e5e7eb;cursor:pointer}
    button:hover{background:#374151}
    .row{display:flex;flex-wrap:wrap;align-items:center;gap:.5rem;margin:.5rem 0}
    .meter{width:180px}
  </style>
</head>
<body>
<div class="wrap">
  <h2>ğŸ¹ Tone.Sampler â€“ 8ê°œ ìƒ˜í”Œ(C/F#)</h2>
  <div class="row">
    <button id="btnStart">ğŸ”Š Audio ì‹œì‘</button>
    <button id="btnScale">ë„ë ˆë¯¸íŒŒì†” (C4~G4)</button>
    <button id="btnChord">Cë©”ì´ì € ì½”ë“œ</button>
    <button id="btnArp">ì•„ë¥´í˜ì§€ì˜¤</button>
  </div>
  <div class="row">
    <label>ë¦¬ë²„ë¸Œ(ë£¸): <input id="rev" class="meter" type="range" min="0" max="0.95" step="0.01" value="0.35" /></label>
    <label>ë³¼ë¥¨(dB): <input id="vol" class="meter" type="range" min="-24" max="0" step="1" value="-6" /></label>
  </div>
  <p>ìƒ˜í”Œ ê²½ë¡œ: <code>samples/piano/</code> (í•„ìš” ì‹œ ì½”ë“œì—ì„œ ìˆ˜ì •)</p>
</div>

<script>
/* ---------- ì´ ê²½ë¡œë¥¼ ì‹¤ì œ í´ë”ì— ë§ê²Œ ë°”ê¾¸ì„¸ìš” ---------- */
const BASE = "samples/piano/";

/* ë¦¬ë²„ë¸Œ & ì»´í”„ & ê²Œì¸ */
const reverb = new Tone.Freeverb({ roomSize: 0.35, dampening: 2500 }).toDestination();
const comp   = new Tone.Compressor(-14, 3).connect(reverb);
const gain   = new Tone.Gain(Tone.dbToGain(-6)).connect(comp);

/* Sampler: C/F# 8ê°œë§Œ ë¡œë“œ (íŒŒì¼ëª…ì€ Fsë¡œ ì €ì¥ ê¶Œì¥) */
const piano = new Tone.Sampler({
  urls: {
    "C2": "C2.wav",
    "F#2": "Fs2.wav",
    "C3": "C3.wav",
    "F#3": "Fs3.wav",
    "C4": "C4.wav",
    "F#4": "Fs4.wav",
    "C5": "C5.wav",
    "F#5": "Fs5.wav"
  },
  baseUrl: "https://jh7300.github.io/repeating-decimal-music/samples/piano/",
  attack: 0.004,
  release: 1.4
}).connect(gain);

/* UI */
const btnStart = document.getElementById("btnStart");
const btnScale = document.getElementById("btnScale");
const btnChord = document.getElementById("btnChord");
const btnArp   = document.getElementById("btnArp");
const revKnob  = document.getElementById("rev");
const volKnob  = document.getElementById("vol");

btnStart.onclick = async () => {
  await Tone.start();
  // ë¡œë”© ëŒ€ê¸°(ì„ íƒ): ìƒ˜í”Œì´ ì¤€ë¹„ëëŠ”ì§€ ë³´ì¥
  await piano.loaded;
  btnStart.textContent = "âœ… ì¤€ë¹„ì™„ë£Œ";
};

revKnob.oninput = e => { reverb.roomSize.value = Number(e.target.value); };
volKnob.oninput = e => { gain.gain.value = Tone.dbToGain(Number(e.target.value)); };

btnScale.onclick = () => {
  const now = Tone.now();
  ["C4","D4","E4","F4","G4"].forEach((n,i)=>{
    const t = now + i*0.35 + (Math.random()*0.012-0.006); // ì•½ê°„ humanize
    const vel = 0.75 + (Math.random()*0.2-0.1);
    piano.triggerAttackRelease(n, "8n", t, vel);
  });
};

btnChord.onclick = () => {
  const now = Tone.now();
  const notes = ["C4","E4","G4"];
  // ì‚´ì§ ìŠ¤íŠ¸ëŸ¼(í˜„ ê°„ ì‹œê°„ì°¨)
  notes.forEach((n,i)=>{
    const t = now + i*0.02 + (Math.random()*0.006-0.003);
    piano.triggerAttackRelease(n, "2n", t, 0.85 - i*0.05);
  });
};

btnArp.onclick = () => {
  const now = Tone.now();
  const seq = ["C4","E4","G4","B4","C5","G4","E4","C4"];
  seq.forEach((n,i)=>{
    const t = now + i*0.28 + (Math.random()*0.01-0.005);
    piano.triggerAttackRelease(n, "8n", t, 0.8);
  });
};
</script>
</body>
</html>

